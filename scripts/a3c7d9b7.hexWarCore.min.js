"use strict";var WINDOW_EXSIST="undefined"==typeof window,hexWarCore=WINDOW_EXSIST?hexWarCore||(hexWarCore={}):window.hexWarCore||(window.hexWarCore={});hexWarCore.WINDOW_EXSIST=WINDOW_EXSIST,function(){hexWarCore.neighbourName=[[["bottomRight","bottom","bottomLeft"],["topRight","IMPOSSIBLE","topLeft"],["IMPOSSIBLE","top","IMPOSSIBLE"]],[["IMPOSSIBLE","bottom","IMPOSSIBLE"],["bottomRight","IMPOSSIBLE","bottomLeft"],["topRight","top","topLeft"]]],hexWarCore.neighbours=[[[1,0],[-1,1],[0,-1],[-1,-1],[-1,0],[0,1]],[[1,1],[1,0],[0,-1],[-1,0],[1,-1],[0,1]]]}(hexWarCore),WINDOW_EXSIST&&importScripts("/scripts/core/utilities.js","/scripts/core/hex.js","/scripts/core/board.js","/scripts/core/player.js","/scripts/core/game.js"),function(){hexWarCore.isDefined=function(a){return"undefined"!=typeof a}}(hexWarCore),hexWarCore.Hex=function(a){function b(b,c,d){if(a.isDefined(c)&&a.isDefined(d))this.population=b,this.coord=c,this.owner=d,this.percentMax=100;else for(var e in b)this[e]=b[e]}function c(b,c){return a.isDefined(b)?c-b:c}return b.prototype.getNameOfNeighbour=function(b){var c;return a.isDefined(b)&&a.neighbours[(this.coord.c+1)%2].forEach(function(d){var e={r:b.coord.r+d[0],c:b.coord.c+d[1]};this.coord.c===e.c&&this.coord.r===e.r&&(c=a.neighbourName[(this.coord.c+1)%2][d[0]+1][d[1]+1])},this),c},b.prototype.getNeighbour=function(b){var c,d=a.neighbourName[(this.coord.c+1)%2];a:for(var e=0;3>e;e++)for(var f=0;3>f;f++)if(d[e][f]===b){c={r:this.coord.r-(e-1),c:this.coord.c-(f-1)};break a}return c},b.prototype.prepareMove=function(b){if(this.population-=c(this[b.directionName],b.moveCount),this[b.directionName]=b.moveCount,a.isDefined(b.permanentMove)){var d=b.directionName+"_permanent";0!==b.permanentMove?(this.percentMax-=c(this[d],b.permanentMove),this[d]=b.permanentMove):(this.percentMax+=this[d],delete this[d])}},b.prototype.performMove=function(a){delete this[a.directionName]},b.prototype.recive=function(a){this.owner===a.from.owner?this.population+=a.moveCount:(this.population-=a.moveCount,this.population<0&&(this.population*=-1,this.owner=a.from.owner))},b.prototype.grow=function(){this.population++},b}(hexWarCore),hexWarCore.Board=function(a){function b(b,c){var d,e;if("undefined"!=typeof c)for(this.board=JSON.parse(JSON.stringify(b)),this.board.rLength=Object.keys(this.board).length,this.board.cLength=Object.keys(this.board[0]).length,d=0;d<this.board.rLength;d++)for(e=0;e<this.board.cLength;e++){var f=Number.parseInt(this.board[d][e].owner.slice(-1),10);this.board[d][e]=new a.Hex(this.board[d][e].population,{r:d,c:e},Number.isNaN(f)||"none"!==c[f].type?this.board[d][e].owner:"natural")}else for(this.board={},this.board.rLength=b.board.rLength,this.board.cLength=b.board.cLength,d=0;d<this.board.rLength;d++)for(this.board[d]={},e=0;e<this.board.cLength;e++)this.board[d][e]=new a.Hex(b.board[d][e])}return b.prototype.getRowCount=function(){return this.board.rLength},b.prototype.getColumnCount=function(){return this.board.cLength},b.prototype.getBoard=function(){return this.board},b.prototype.getField=function(b){return a.isDefined(b)&&a.isDefined(b.c)&&a.isDefined(b.r)&&a.isDefined(this.board[b.r])?this.board[b.r][b.c]:void 0},b.prototype.getFieldOf=function(a){for(var b=[],c=0;c<this.board.rLength;c++)for(var d=0;d<this.board.cLength;d++){var e=this.board[c][d];e.owner===a&&b.push(e)}return b},b.prototype.getStatistic=function(){for(var b={},c=0;c<this.board.rLength;c++)for(var d=0;d<this.board.cLength;d++){var e=this.board[c][d];a.isDefined(b[e.owner])?b[e.owner]++:b[e.owner]=1}return b},b}(hexWarCore),hexWarCore.Player=function(){function a(a,b){this.type=a.type,this.id=b,this.name=a.name,this.actions=[]}return a.prototype.fnTemplate=function(){},a}(hexWarCore),hexWarCore.Game=function(a){function b(b,c){this.gameFinished=!1,this.board=new a.Board(b,c),this.players=[],this.turn=0;var d;for(d=1;d<=c.map.maxPlayer;d++)"none"!==c[d].type&&this.players.push(new a.Player(c[d],"player"+d))}return b.prototype.nextTurn=function(){this.performActions(),console.log(this.players),1===this.players.length&&(this.gameFinished=!0),this.board.getFieldOf(this.getActualPlayer().id).forEach(function(a){a.grow()}),this.turn++,this.prepareSettedAction()},b.prototype.prepareSettedAction=function(){var a,b=this.getActualPlayer().actions;for(b.forEach(function(a){a.moveCount=Math.floor(a.permanentMove/100*a.from.population)}),a=0;a<b.length;a++)this.getActualPlayer().id===b[a].from.owner?b[a].moveCount=Math.floor(b[a].permanentMove/100*b[a].from.population):b.splice(a--,1);b.forEach(function(a){a.from.prepareMove(a)})},b.prototype.performActions=function(){var b,c=this.getActualPlayer().actions;for(b=0;b<c.length;b++)c[b].from.performMove(c[b]),c[b].to.recive(c[b]),(angular.isUndefined(c[b].permanentMove)||0===c[b].permanentMove)&&c.splice(b--,1);var d=this.board.getStatistic();this.players.forEach(function(b){if(!a.isDefined(d[b.id])){var c=this.players.indexOf(b);c>-1&&this.players.splice(c,1)}},this)},b.prototype.reciveAction=function(a){for(var b=this.getActualPlayer().actions,c=-1,d=0;d<b.length;d++)if(b[d].from.coord.r===a.from.coord.r&&b[d].from.coord.c===a.from.coord.c&&b[d].directionName===a.directionName){c=d;break}c>-1&&b.splice(c,1),b.push(a),a.from.prepareMove(a)},b.prototype.getActualPlayer=function(){return this.players[this.turn%this.players.length]},b.prototype.isFinished=function(){return this.gameFinished},b.prototype.getBoardRowCount=function(){return this.board.getRowCount()},b.prototype.getBoardColumnCount=function(){return this.board.getColumnCount()},b.prototype.getBoardField=function(a){return this.board.getField(a)},b.prototype.isAITurn=function(){return"ai"===this.getActualPlayer().type},b}(hexWarCore);